
<!DOCTYPE html>
<html lang="en">
<head>
  <title>Swapno Your nearest Outlet Location Map</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
      *{margin:0;padding:0}
      .wp_wrapper, .slider_1{width:100%;height:250px;}
      #map{width:100%;height:500px}
      .responsive{width:100%;height:auto;margin-bottom:20px}
  </style>
</head>
<body>
  <div class="wp_wrapper">
    <div class="slider_1">
      <img src="swapno.jpg" alt="">
    </div>
    <!-- <img src="bg1.png" class="responsive"> -->
    <div class="container">
      <div class="row">
        <div class=" col-md-12 col-sm-12 ">
         <div id="map"></div>
        </div>
      </div>
    </div>
  </div>


<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC8MQrdVaz8JKiUnSU0usHzGRQGrI_x3DQ&callback=initMap&libraries=geometry,places" async defer="defer"></script>

<script>

  let slider_1 = document.querySelector('.slider_1');



    setTimeout(getLocation, false);
    function getLocation() {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(showPosition);
      }
    }
    var mylat, mylon;
    function showPosition(position) {
      mylat =  position.coords.latitude;
      mylon =  position.coords.longitude;
      if (mylat) {
        setTimeout(initMap,100);
      }
    }

    function initMap() {
      if (mylat) {
        // console.info(mylat + ' longitude ' + mylon);
        var map;
        var myOptions = {
          zoom: 10,
          scrollwheel: true,
          mapTypeId: 'roadmap'
        };
        // map for search & directions
        map = new google.maps.Map(document.querySelector('#map'), myOptions);
        var markerA = new google.maps.Marker({
          position: {lat:mylat, lng: mylon},
          map: map
        });

      var infowindow = new google.maps.InfoWindow;
      var loc, i;
      var locations = [];
      var locs = location_names();

      // create markers for each loc and place them on map
      for (i = 0; i < locs.length; i++) {
        loc = new google.maps.Marker({
          position: new google.maps.LatLng(locs[i][1], locs[i][2]),
          map,
          icon: 'icon-shwapno.jpg?v=1.1' 
        });

        google.maps.event.addListener( loc, 'click', (function(loc, i)  {
          return function() {
            infowindow.setContent(locs[i][0]);
            infowindow.open(map, loc);
          }
        })( loc, i ));
        locations.push(loc.position);
      }

      var pointA = markerA.getPosition();
      var markerB;

      findClosest(pointA, locations);

      function findClosest( pointA, locations ) {
        var closestDistance = Number.MAX_SAFE_INTEGER;
        var closest;
        for ( i = 0; i < locations.length; i++ ) {
          var distance = google.maps.geometry.spherical.computeDistanceBetween(pointA, locations[i]);
          if ( distance < closestDistance ) {
            closestDistance = distance;
            closest = locations[i];
          }
        }
        markerB = closest;
      }

      var directionsService = new google.maps.DirectionsService;
      var directionsDisplay = new google.maps.DirectionsRenderer({map});

      // for( var j=0; j < locations.length; j++ ) {
      //   calculateAndDisplayRoute(directionsService, directionsDisplay, pointA, locations[j], map);
      // }

      // var pointB = markerB;
      // console.log(markerB);
      calculateAndDisplayRoute(directionsService, directionsDisplay, pointA, markerB, map);

      // var onChangeHandler = function() {
        // calculateAndDisplayRoute(directionsService, directionsDisplay, pointA, markerB, map);
      // };
      // map.addListener('change', onChangeHandler);
        
      }else{
        setTimeout(getLocation, false);
      }

      
  }

  function calculateAndDisplayRoute(directionsService, directionsDisplay, pointA, pointB, map) {
      directionsService.route({
       origin: pointA,
       destination: pointB,
       travelMode: google.maps.TravelMode.WALKING
      }, function (response, status) {
       if (status == google.maps.DirectionsStatus.OK) {
        directionsDisplay.setDirections(response);
       } else {
        console.error('Could not load directions due to ' + status);
       }
      });
  }

  // create array of locations and assign values
  function location_names() 
  {
    return [
      [ "Shwapno - Gulshan 1",   "23.77533200072377", "90.41582053998829"],
      [ "Shwapno - Gulshan 2",   "23.788763867040725", "90.41702184014922"],
      [ "Swapno General Store",   "23.773722960507488", "90.42071225151226"],
      [ "Shwapno Banani",   "23.79110450675467", "90.41188832001471"],
      [ "Shwapno Express - Thana Road, Uttar Badda",   "23.788514938065237", "90.42909561088275"],
      [ "Swapno Express - Link Road",   "23.78121012629599", "90.42394445573912"],
    ];
  }
</script>
</body>
</html>
